<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZCM Track - Administrator</title>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script src="../schedule.js"></script>
    <link rel="stylesheet" href="../styles.css">

</head>

<body>

    <!-- LOGIN VIEW -->
    <div id="view-login" class="view">
        <div class="container h-screen flex items-center justify-center">
            <div class="card login-card">
                <h2 class="text-xl font-bold mb-4 text-center">ZCM Track - Administrator</h2>
                <div class="flex flex-col items-center gap-4">
                    <div id="g_id_onload"
                        data-client_id="840411102964-5vqmoroj9jdcthf099ikvadofcgveefv.apps.googleusercontent.com"
                        data-callback="handleGoogleLogin" data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                        data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD VIEW -->
    <div id="view-dashboard" class="view hidden">
        <div class="nav-header">
            <div class="container nav-content">
                <div class="nav-brand"><i class="fas fa-chart-pie"></i> Dashboard</div>
                <div class="nav-links">
                    <a onclick="app.switchTab('dashboard')" class="nav-link active" id="tab-dashboard">Dashboard</a>
                    <a onclick="app.switchTab('class')" class="nav-link" id="tab-class">Class</a>
                    <a onclick="app.switchTab('teachers')" class="nav-link" id="tab-teachers">Teachers</a>
                    <a onclick="app.switchTab('admin')" class="nav-link" id="tab-admin">Admin</a>
                    <a onclick="app.logout()" class="nav-link text-danger"><i class="fas fa-sign-out-alt"></i></a>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Overview Tab -->
            <div id="content-dashboard" class="tab-content">
                <div class="dashboard-grid">
                    <div class="stat-card" style="border-color: #059669;">
                        <div class="stat-value" id="stat-on-time">0</div>
                        <div class="stat-label">Checked in on time</div>
                    </div>
                    <div class="stat-card" style="border-color: var(--warning);">
                        <div class="stat-value" id="stat-late">0</div>
                        <div class="stat-label">Late Arrivals</div>
                    </div>
                    <div class="stat-card" style="border-color: var(--danger);">
                        <div class="stat-value" id="stat-absent">0</div>
                        <div class="stat-label">Absent / No Teacher</div>
                    </div>
                </div>

                <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="card">
                        <h3 class="font-bold mb-4">Weekly Attendance Trend</h3>
                        <canvas id="chart-attendance"></canvas>
                    </div>
                    <div class="card">
                        <h3 class="font-bold mb-4">Recent Activity</h3>
                        <div id="recent-activity-list" class="flex flex-col gap-2">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matrix Tab -->
            <div id="content-class" class="tab-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                    <h2 class="text-lg font-bold">Class</h2>
                    <div class="flex gap-2 flex-wrap">
                        <select id="matrix-grade" class="input" style="width: auto;" onchange="app.renderMatrix()">
                            <option value="">All Grades</option>
                            <option value="6">Grade 6</option>
                            <option value="7">Grade 7</option>
                            <option value="8">Grade 8</option>
                            <option value="9">Grade 9</option>
                            <option value="10">Grade 10</option>
                            <option value="11">Grade 11</option>
                        </select>
                        <input type="date" id="matrix-date" class="input" style="width: auto;"
                            onchange="app.renderMatrix()">
                    </div>
                </div>
                <div class="table-container">
                    <table id="matrix-table">
                        <thead>
                            <tr>
                                <th>Class</th>
                                <th>P1</th>
                                <th>P2</th>
                                <th>P3</th>
                                <th>P4</th>
                                <th>P5</th>
                                <th>P6</th>
                                <th>P7</th>
                                <th>P8</th>
                                <th>P9</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Teacher Stats Tab -->
            <div id="content-teachers" class="tab-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <h1 class="text-xl font-bold mb-2">ZCM Track</h1>
                    <p class="text-gray-500 mb-6">Teacher Attendance System</p>
                    <select id="stats-teacher-select" class="input" style="max-width: 300px;"
                        onchange="app.renderTeacherStats()">
                        <option value="" disabled selected>Select a Teacher</option>
                        <!-- Populated by JS -->
                    </select>
                </div>

                <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr;">
                    <!-- Left Panel: Daily Detail -->
                    <div class="card">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-gray-700">Daily Detail</h3>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-500">Date</label>
                                <input type="date" id="stats-date" class="input" style="width: auto; padding: 0.5rem;"
                                    onchange="app.renderTeacherStats()">
                            </div>
                        </div>
                        <div class="table-container" style="box-shadow: none; border: 1px solid var(--gray-200);">
                            <table id="stats-daily-table">
                                <thead>
                                    <tr>
                                        <th>Period</th>
                                        <th>Time</th>
                                        <th>Late by</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Right Panel: Summary -->
                    <div class="card bg-gray-50">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-gray-700">Summary</h3>
                            <select id="stats-period-filter" class="input"
                                style="width: auto; padding: 0.25rem 0.5rem; font-size: 0.8rem;"
                                onchange="app.renderTeacherStats()">
                                <option value="weekly">Weekly</option>
                                <option value="monthly" selected>Monthly</option>
                            </select>
                        </div>

                        <div class="flex flex-col gap-6">
                            <div class="flex items-center gap-4">
                                <div class="text-4xl font-bold text-dark" id="summary-on-time">0</div>
                                <div class="text-sm text-gray-500">On time</div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-4xl font-bold text-dark" id="summary-late-10">0</div>
                                <div class="text-sm text-gray-500">10 Minutes delay</div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="text-4xl font-bold text-dark" id="summary-late-20">0</div>
                                <div class="text-sm text-gray-500">20 Minutes delay</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Tab -->
            <div id="content-admin" class="tab-content hidden">
                <div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <!-- Teachers Management -->
                    <div class="card">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold">Teachers</h3>
                            <button onclick="app.openModal('teacher')" class="btn btn-sm btn-primary"><i
                                    class="fas fa-plus"></i> Add</button>
                        </div>
                        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                            <table id="teachers-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Subject</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Classrooms Management -->
                    <div class="card">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold">Classrooms</h3>
                        </div>
                        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                            <table id="classrooms-table">
                                <thead>
                                    <tr>
                                        <th>Class</th>
                                        <th>QR</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <h3 class="font-bold mb-4">System Management</h3>
                    <div class="flex gap-4">
                        <button onclick="app.resetSystem()" class="btn btn-danger">Reset All Data</button>
                        <button onclick="app.printQRCodes()" class="btn btn-secondary">Print All QR Codes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3 id="modal-title" class="text-lg font-bold mb-4">Add Item</h3>
            <form id="modal-form" onsubmit="app.handleModalSubmit(event)">
                <div id="modal-fields" class="flex flex-col gap-4">
                    <!-- Fields injected by JS -->
                </div>
                <div class="flex gap-2 mt-6 justify-end">
                    <button type="button" onclick="app.closeModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Print Area -->
    <div id="print-area" class="hidden"></div>

    <!-- Firebase Config & Admin Logic -->
    <script type="module" src="../admin.js"></script>
</body>

</html>